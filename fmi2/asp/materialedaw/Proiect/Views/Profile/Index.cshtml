@model markly.ViewModels.UserProfileViewModel

@{
    ViewData["Title"] = Model.Username;
}

<div class="container py-5">
    <div class="row g-5">
        @* Sidebar: User Profile *@
        <div class="col-lg-4">
            <div class="card shadow-sm sticky-top" style="top: 2rem; z-index: 1;">
                <!-- Banner Background -->
                <div role="presentation" aria-hidden="true" style="height: 120px; background: linear-gradient(135deg, var(--accent), var(--accent-light)); border-radius: var(--radius-lg) var(--radius-lg) 0 0;"></div>
                
                <div class="card-body text-center pt-0 position-relative">
                    <!-- Profile Picture with border -->
                    <div class="position-relative d-inline-block mb-3" style="margin-top: -60px;">
                        @if (!string.IsNullOrEmpty(Model.ProfilePictureUrl))
                        {
                            <img src="@Model.ProfilePictureUrl" alt="@Model.Username" 
                                class="rounded-circle img-thumbnail shadow-sm" 
                                style="width: 120px; height: 120px; object-fit: cover; border-width: 4px;">
                        }
                        else
                        {
                            <div class="rounded-circle d-inline-flex align-items-center justify-content-center shadow-sm bg-white text-primary border"
                                style="width: 120px; height: 120px; font-size: 3rem; border-width: 4px !important;">
                                @(Model.FirstName?.Length > 0 ? Model.FirstName.Substring(0, 1).ToUpper() : "U")
                            </div>
                        }
                    </div>

                    <h2 class="h4 fw-bold mb-1">@Model.FullName</h2>
                    <p class="text-muted mb-3">@@@Model.Username</p>

                    @if (!string.IsNullOrEmpty(Model.Bio))
                    {
                        <p class="card-text text-secondary mb-4">@Model.Bio</p>
                    }
                    
                    <div class="d-flex justify-content-center gap-3 mb-4 text-muted small">
                        <div class="d-flex align-items-center">
                            <i class="bi bi-calendar3 me-2"></i>
                            Joined @Model.JoinedDate.ToLocalTime().ToString("MMM yyyy")
                        </div>
                    </div>

                    @if (User.Identity?.IsAuthenticated == true && User.Identity.Name == Model.Username)
                    {
                        <div class="d-grid">
                            <a asp-controller="Account" asp-action="Manage" class="btn btn-outline-primary">
                                <i class="bi bi-pencil-square me-2"></i>Edit Profile
                            </a>
                        </div>
                    }
                </div>
                
                @if (Model.Categories.Any())
                {
                    <div class="card-footer bg-white border-top p-4">
                        <h6 class="fw-bold mb-3">@(Model.IsOwner ? "Categories" : "Public Categories")</h6>
                        <div class="d-flex flex-wrap gap-2">
                            @foreach (var category in Model.Categories)
                            {
                                <a asp-controller="Categories" asp-action="Details" asp-route-id="@category.Id" class="badge bg-light text-dark border fw-normal px-3 py-2 text-decoration-none">
                                    <i class="bi bi-folder2-open me-1 text-muted"></i> @category.Name
                                </a>
                            }
                        </div>
                    </div>
                }
            </div>
        </div>
        
        @* Main Content: Bookmarks *@
        <div class="col-lg-8">
            <div class="d-flex align-items-center justify-content-between mb-4">
                <h3 class="fw-bold mb-0">@(Model.IsOwner ? "Bookmarks" : "Public Bookmarks")</h3>
                <span class="badge bg-light text-secondary rounded-pill px-3 py-2">
                    @Model.Bookmarks.Count items
                </span>
            </div>

            @if (Model.Bookmarks.Any())
            {
                <div class="masonry-grid masonry-grid-profile">
                    @foreach (var bookmark in Model.Bookmarks)
                    {
                        <partial name="_BookmarkCard" model="bookmark" />
                    }
                </div>
            }
            else
            {
                <div class="text-center py-5 text-muted bg-white border rounded-4">
                    <img src="~/images/illustrations/no-bookmarks.svg" alt="" class="img-fluid mb-3" style="max-height: 160px;">
                    <h5 class="fw-normal">No bookmarks yet</h5>
                    <p class="small">This user hasn't shared any bookmarks.</p>
                </div>
            }
        </div>
    </div>
</div>
