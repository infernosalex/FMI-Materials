# Dezvoltarea Aplicațiilor Web utilizând ASP.NET Core MVC - Curs 6

Acest curs acoperă noțiuni fundamentale despre baze de date, proiectarea diagramelor Entitate/Relație (E/R) și Conceptuale, precum și implementarea acestora folosind **Entity Framework Core** și **LINQ** în ASP.NET Core.

---

## 1. Baze de Date - Noțiuni Generale

### Ce este o bază de date?

O bază de date este un ansamblu structurat de date coerente, fără redundanță inutilă, permițând prelucrarea eficientă de către mai mulți utilizatori simultan.

### Sistemul de Gestiune a Bazelor de Date (SGBD/DBMS)

* 
**Definiție**: Un produs software care asigură interacțiunea cu o bază de date.


* 
**Funcționalități**: Stochează date în tabele, le accesează folosind limbajul **SQL** și asigură securitatea, integritatea și consistența acestora.


* 
**Exemple**: Oracle Database, Microsoft SQL Server, MySQL.



### Cerințe Minimale

* Redundanță minimă.


* Sincronizarea datelor pentru utilizarea simultană.


* Securitatea și integritatea datelor (recuperare în caz de erori).


* Furnizare rapidă și flexibilitate.



---

## 2. Concepte Cheie în Modelarea Datelor

| Concept | Descriere |
| --- | --- |
| **Cheie Primară (PK)** | Identificator **UNIC** pentru intrările dintr-un tabel; nu poate fi `null`.

 |
| **Cheie Externă (FK)** | Referă o cheie primară dintr-un tabel de legătură; poate fi `null` sau trebuie să corespundă unei valori PK existente.

 |
| **Cheie Primară Compusă** | Creată prin combinarea a două sau mai multe coloane pentru a forma un identificator unic.

 |
| **Entitate** | Reprezintă un loc, acțiune sau persoană (ex: Studenți, Cursuri). În modelul E/R sunt substantive, iar în cel relațional devin tabele.

 |
| **Relație** | Asociere între entități (reprezentate prin verbe). Tipuri: **one-to-one (1:1)**, **one-to-many (1:m)**, **many-to-many (m:m)**.

 |
| **Atribut** | O proprietate care descrie o entitate, având nume, tip de date și constrângeri.

 |

---

## 3. Proiectarea Diagramei Entitate/Relație (E/R)

Regulile de proiectare includ:

1. Identificarea entităților.
2. Identificarea relațiilor dintre entități.
3. Stabilirea cardinalităților minime și maxime.
4. Identificarea atributelor asociate fiecărei entități.
5. Stabilirea cheilor primare.

### Exemplu Practic: Engine de Știri

Pentru un sistem de știri, entitățile identificate sunt:

* **USER**: Utilizatorii sistemului.
* **ROLE**: Tipuri de utilizatori (Vizitator, Înregistrat, Editor, Administrator).
* **ARTICLE**: Știrile postate.
* **COMMENT**: Comentariile la știri.
* **CATEGORY**: Categoriile știrilor (Știință, Tehnologie, etc.).

---

## 4. Diagrama Conceptuală

Transformarea din modelul E/R în cel Conceptual urmează reguli specifice:

* Entitățile devin **tabele**.
* Relațiile **one-to-many** devin chei externe plasate în tabelul cu cardinalitatea "many".
* Relațiile **many-to-many** devin **tabele asociative**.

---

## 5. ASP.NET Core Identity

Framework-ul oferă un sistem preconfigurat pentru autentificare și autorizare:

* Gestionarea utilizatorilor și rolurilor.


* Autentificare cu user/parolă sau externă (Google, Facebook).


* Pentru activare, se alege **Individual Accounts** la crearea proiectului.


* 
**Comandă esențială**: `Update-Database` în Package Manager Console pentru a crea tabelele de identitate.



---

## 6. Implementare cu Entity Framework Core (EF Core)

### Definirea Claselor (Models)

În EF Core, clasele sunt la singular (ex: `Article.cs`), iar tabelele rezultate sunt la plural (`Articles`).

```csharp
public class Article
{
    [Key]
    public int Id { get; set; }
    
    [Required(ErrorMessage = "Titlul este obligatoriu")]
    public string Title { get; set; }
    
    public virtual Category Category { get; set; [cite_start]} // Lazy Loading [cite: 381, 385, 391]
    public virtual ICollection<Comment> Comments { get; set; [cite_start]} [cite: 392]
}

```

### Lazy Loading

Proprietățile sunt declarate ca `virtual` pentru a permite **Lazy Loading**. Acest pattern întârzie încărcarea resurselor până în momentul utilizării lor efective pentru a îmbunătăți performanța.

### Interogări LINQ și Join-uri

* 
**Include**: Folosit pentru a încărca datele relaționate (Eager Loading).


* Exemplu: `db.Articles.Include("Category")`.




* 
**Group By**: Utilizat pentru funcții de grup, cum ar fi numărarea articolelor per categorie folosind `.Count()`.



### Migrații

După modificarea modelelor, se execută:

1. `Add-Migration NumeMigratie`
2. `Update-Database`

---
# Dezvoltarea Aplicațiilor Web utilizând ASP.NET Core MVC - Laborator 6

Acest laborator se concentrează pe configurarea unui proiect practic numit **ArticlesApp**, implementarea modelelor de date și realizarea operațiilor CRUD (Create, Read, Update, Delete) într-un mediu cu autentificare.

---

## 1. Configurarea Proiectului

* 
**Creare**: Se creează un nou proiect ASP.NET Core Web App (MVC) cu numele **ArticlesApp**.


* 
**Autentificare**: Proiectul trebuie să includă sistemul de autentificare (Individual Accounts).


* 
**Pachete necesare**: Se verifică existența pachetelor NuGet esențiale:


* 
`Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore` 


* 
`Microsoft.AspNetCore.Identity.EntityFrameworkCore` 


* 
`Microsoft.AspNetCore.Identity.UI` 


* 
`Microsoft.EntityFrameworkCore.SqlServer` 


* 
`Microsoft.EntityFrameworkCore.Tools` 





---

## 2. Baza de Date și Migrări

* 
**Update-Database**: Deoarece migrația inițială pentru Identity există deja (`CreateIdentitySchema.cs`), se rulează doar comanda `Update-Database` în Package Manager Console.


* 
**Verificare**: Tabelele pot fi vizualizate în **SQL Server Object Explorer**.


* 
**Testare**: Se rulează proiectul și se înregistrează un cont nou; acesta va apărea în tabelul `dbo.AspNetUsers`.



---

## 3. Implementarea Modelelor

Se implementează următoarele entități în folderul `Models`:

### Article

* 
**Proprietăți**: `Id` (PK), `Title` (obligatoriu), `Content` (obligatoriu), `Date`, `CategoryId` (FK).


* 
**Relații**: Referință către `Category` și o colecție de `Comments`.



### Category

* 
**Proprietăți**: `Id` (PK), `CategoryName` (obligatoriu).


* 
**Relații**: O colecție de `Articles`.



### Comment

* 
**Proprietăți**: `Id` (PK), `Content` (obligatoriu), `Date`, `ArticleId` (FK).



---

## 4. Operații CRUD

Pentru fiecare entitate se adaugă un **Controller** (`ArticlesController`, `CategoriesController`, `CommentsController`) și folderele corespunzătoare în **Views**.

Entitatea Article 

* 
**Index**: Afișarea tuturor articolelor folosind componente **Bootstrap Cards**.


* 
**Show**: Vizualizarea unui singur articol detaliat.


* 
**New/Edit**: Adăugarea sau editarea unui articol, utilizând un **dropdown** pentru selecția categoriei.


* 
**Delete**: Ștergerea articolului.



### Entitatea Category

* Implementarea operațiilor CRUD; la ștergerea unei categorii, se vor șterge automat toate articolele asociate (Cascade Delete).



---

## 5. Agile și Prompt Engineering

Exercițiul propune utilizarea agenților AI (ChatGPT, Claude, Gemini) pentru:

* Împărțirea eficientă a task-urilor într-o echipă Agile.


* Estimarea duratei sprint-urilor și identificarea blocajelor.


* Simularea rolului de Scrum Master sau Product Owner.



---

## 6. Temă (Comments)

Se cere implementarea CRUD pentru entitatea **Comment**:

* Afișarea comentariilor în pagina de `Show` a unui articol.


* Funcționalități de adăugare, editare și ștergere pentru comentarii.
