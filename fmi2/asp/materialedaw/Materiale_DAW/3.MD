## Dezvoltarea Aplicațiilor Web utilizând ASP.NET Core MVC - Curs 3

Acest curs prezintă arhitectura **MVC (Model-View-Controller)**, structura unui proiect în **ASP.NET Core 9.0** și funcționarea **sistemului de rutare**.

---

### 1. Arhitectura MVC

Model-View-Controller este un model arhitectural care izolează logica aplicației de interfața cu utilizatorul, facilitând modificarea aspectului vizual sau a regulilor de business fără a afecta celelalte niveluri.

| Componentă | Responsabilitate |
| --- | --- |
| **Model** | Gestionarea și manipularea datelor; reprezintă nucleul aplicației și realizează legătura cu baza de date.

 |
| **Controller** | Controlează accesul la aplicație, procesează request-urile HTTP, citește datele de la utilizator și comunică cu Modelul și View-ul.

 |
| **View** | Interfața cu utilizatorul; afișează datele și înregistrările din baza de date prin intermediul browser-ului.

 |

> **Notă:** În Controller, fiecare metodă publică este considerată un **Action**. Acestea trebuie să fie publice pentru ca framework-ul MVC să le poată accesa și invoca în urma unei cereri HTTP.
> 
> 

---

### 2. Structura Proiectului (Sistemul de fișiere)

Un proiect MVC nou creat în Visual Studio 2022 include următoarele elemente esențiale:

* 
**wwwroot:** Conține fișiere statice (librării precum Bootstrap, imagini, scripturi CSS/JS).


* 
**Controllers:** Include clasele C# care gestionează cererile; numele acestora trebuie să se termine obligatoriu în `Controller`.


* 
**Models:** Folderul care stochează modelele de date ale aplicației.


* 
**Views:** Conține interfețele utilizator (.cshtml).


* 
**appsettings.json:** Fișier de configurare (format JSON) pentru detalii precum conexiunea la baza de date sau setările de logging.


* 
**Program.cs:** Punctul de pornire al aplicației; aici se configurează serviciile, serverul web (IIS) și pipeline-ul middleware.



---

### 3. Sistemul de Rutare

Rutarea elimină necesitatea mapării URL-urilor cu fișiere fizice, folosind URL-uri logice pentru a invoca metode din Controllere.

#### Formatul de bază al rutelor:

`/{NumeController}/{NumeActiune}/{Parametri}` 

#### Definirea în Program.cs:

Rutele se configurează folosind metoda `MapControllerRoute()`. În ASP.NET Core 9.0, aceasta se integrează cu noul sistem unificat de **Static Assets** prin `.WithStaticAssets()`.

* 
**Ruta Default:** Identifică în mod implicit `HomeController` și acțiunea `Index`.


* 
**Parametri Opționali:** Un parametru urmat de semnul întrebării (ex: `{id?}`) indică faptul că acesta poate fi omis din URL.


* 
**Constrângeri:** Se pot impune reguli asupra parametrilor (tip de date, lungime, interval sau expresii regulate).


* 
*Exemplu Range:* `pattern: "Verify/{id:range(10,100)}"`.


* 
*Exemplu Regex:* `pattern: "VerifyDigits/{id:regex(\\d+)}"`.





---

### 4. Pipeline Middleware

Reprezintă un lanț de componente software prin care trece o cerere HTTP. Fiecare componentă (Middleware) poate procesa cererea sau decide trimiterea ei mai departe.

**Exemple de middleware în pipeline:**

1. 
**UseRouting():** Activează mecanismul de potrivire a cererii cu rutele definite.


2. 
**UseAuthorization():** Verifică permisiunile utilizatorului.


3. 
**MapControllerRoute():** Definește efectiv rutele și finalizează cererea.



---

### Diferențe .NET 8 vs .NET 9

În **.NET 8**, fișierele statice erau servite separat prin `app.UseStaticFiles()`. În **.NET 9**, sistemul este unificat pentru o performanță mai mare, oferind optimizare automată și cache inteligent prin utilizarea hash-urilor în URL.


## Dezvoltarea Aplicațiilor Web utilizând ASP.NET Core MVC - Laborator 3

Acest laborator conține exerciții practice pentru implementarea Controller-elor și a sistemului de rutare în **ASP.NET Core 9.0**.

---

### Exercițiul 1: Implementare ExamplesController

Se cere crearea unui proiect nou și adăugarea unui Controller numit `ExamplesController` cu următoarele acțiuni și rute:

1. **Rută Concatenare:**
* 
**URL:** `/concatenare/{param1}/{param2}`.


* 
**Funcționalitate:** Primește doi parametri de tip string și afișează valorile lor concatenate.




2. **Rută Produs:**
* 
**URL:** `/produs/param1/param2`.


* 
**Parametri:** Două numere întregi; al doilea este opțional.


* 
**Funcționalitate:** Afișează produsul celor două numere sau mesajul "Introduceți ambele valori" dacă lipsește parametrul opțional.




3. **Rută Operație:**
* 
**URL:** `/operatie/param1/param2/op`.


* 
**Parametri:** Doi întregi și un string (`op`) reprezentând operația (plus, minus, ori, div).


* 
**Funcționalitate:** Afișează parametrii, operația și rezultatul. Dacă un parametru lipsește, afișează "Introduceți parametrul 1/2/3".





---

### Exercițiul 2: Operații C.R.U.D. pentru Studenți

Se implementează `StudentsController` pentru a gestiona resursa **Student** prin rute specifice:

| Acțiune | Rută (Name) | URL Pattern | Mesaj/Funcționalitate |
| --- | --- | --- | --- |
| **Index (v1)** | StudentsIndex | `/Students/Index` | Afișarea tuturor studenților.

 |
| **Index (v2)** | StudentsAll | `students/all` | Variantă alternativă pentru afișare.

 |
| **Show** | StudentShow | `students/{id}` | "Afișare student cu ID: {id}" (id opțional).

 |
| **Create** | StudentCreate | `students/new` | "Creare student în baza de date".

 |
| **Edit** | StudentEdit | `students/{id}` | "Editare student cu ID: {id}" (id opțional).

 |
| **Delete** | StudentDelete | `students/{id}` | "Ștergere student cu ID: {id}" (id opțional).

 |

> 
> **Observație:** Utilizarea aceluiași pattern URL (`students/{id}`) pentru Show, Edit și Delete poate crea ambiguitate dacă nu sunt diferențiate prin metode HTTP sau constrângeri suplimentare.
> 
> 

---

### Exercițiul 3: Căutare cu Constrângeri (SearchController)

Implementarea unei pagini de căutare pentru numere de telefon cu validări la nivel de Controller și de rută.

#### Constrângeri și Validări:

* 
**Format Rută:** `search/telefon/{telef:regex()}`.


* 
**Reguli:** Lungime exactă de 10 cifre, începând obligatoriu cu cifra `0`.


* **Logica din Controller:**
* Dacă parametrul lipsește: "Introduceti numarul de telefon".


* Dacă lungimea < 10: "Numarul de telefon nu are suficiente cifre".


* Dacă lungimea > 10: "Numarul de telefon are prea multe cifre".


* Valid format: "Cautare pentru nr de telefon: {telef}".





#### Exemplu Configurare Rută (regex):

```csharp
app.MapControllerRoute(
    name: "NrTelefon",
    pattern: "search/telefon/{telef:regex(^0\\d{9}$)?}",
    defaults: new { controller = "Search", action = "NumarTelefon" });

```

(Notă: Expresia regulată `^0\d{9}$` asigură începerea cu 0 urmat de încă 9 cifre.)
