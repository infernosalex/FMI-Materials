## Dezvoltarea Aplicațiilor Web utilizând ASP.NET Core MVC - Curs 8

### Cuprins

* 
**View (interfața cu utilizatorul)** 


* 
**Validarea cu ajutorul atributelor de validare** 


* Atribute de validare la nivel de Model (Data Annotations) 


* Error Message 


* Exemple de implementare la nivel de Model 




* 
**Preluarea validărilor în View** 


* Atributul `asp-validation-for` 


* Includerea librăriilor jQuery Validation și jQuery Unobtrusive Validation 


* Atributul `asp-validation-summary` 




* 
**Validări custom** 


* Validare custom folosind atribute personalizate 


* Validare pe serviciu (`IValidatableObject`) 




* 
**Implementarea validărilor la nivel de Controller** 


* 
**View-uri partajate** 


* Layout View 


* Adăugarea unui nou Layout 


* Partial View 





---

## 1. Validarea în ASP.NET Core MVC

Validarea se realizează prin adăugarea atributelor necesare direct în **Model**. Aceste atribute integrează regulile de validare pentru fiecare proprietate a modelului și sunt utilizate împreună cu **Model Binding** și **Data Annotations**.

### Atribute de validare comune (Data Annotations)

Cele mai utilizate atribute din namespace-ul `System.ComponentModel.DataAnnotations` includ:

* 
**Required**: Verifică dacă inputul este diferit de null.


* 
**StringLength**: Verifică lungimea unui string (permite setarea minimului și maximului).


* 
**Range**: Verifică dacă valoarea se află într-un anumit interval.


* 
**RegularExpression**: Verifică respectarea unei expresii regulate.


* 
**EmailAddress**: Verifică formatul unei adrese de e-mail.


* 
**MaxLength / MinLength**: Specifică limitele pentru array-uri sau string-uri.



> 
> **Diferența cheie**: `StringLength` este folosit pentru validarea modelului și nu influențează implicit baza de date, în timp ce `MaxLength` este utilizat în special pentru migrații EF Core pentru a seta dimensiunea coloanei în baza de date.
> 
> 

---

## 2. Implementarea Validării în View

Pentru a afișa erorile în interfața utilizatorului, se folosesc Tag Helper-e specifice:

### Atributul `asp-validation-for`

Acesta este utilizat pentru a afișa mesaje de eroare individuale lângă fiecare câmp.

```html
<div class="form-group">
    <label asp-for="Title" class="form-label">Titlu Articol</label>
    <input asp-for="Title" class="form-control" />
    <span asp-validation-for="Title" class="text-danger"></span>
</div>

```

### Atributul `asp-validation-summary`

Afișează un sumar al tuturor erorilor de validare. Valorile posibile includ:

* 
**ModelOnly**: Afișează doar mesajele generale adăugate în Controller prin `ModelState.AddModelError(string.Empty, "...")`.


* 
**All**: Afișează toate erorile, inclusiv cele de la nivel de câmp.


* 
**None**: Nu afișează nimic.



### Validarea pe Client

Pentru a oferi feedback instantaneu fără a reîncărca pagina, trebuie incluse librăriile jQuery în layout-ul paginii:

1. 
`jquery.validate.min.js` 


2. 
`jquery.validate.unobtrusive.min.js` 



---

## 3. Validări Custom

Există două modalități principale pentru validări personalizate:

### A. Atribute Personalizate

Se creează o clasă care moștenește `ValidationAttribute` și se suprascrie metoda `IsValid`.
**Exemplu**: Un atribut care limitează conținutul la 200 de caractere.

### B. Validare pe Serviciu (`IValidatableObject`)

Clasa modelului implementează interfața `IValidatableObject` pentru validări complexe care implică mai multe proprietăți. Aceasta folosește cuvântul cheie `yield` pentru a genera erorile secvențial.

---

## 4. View-uri Partajate și Reutilizarea Codului

### Layout View

Permite definirea unei structuri comune (Header, Footer) pentru toate paginile.

* 
**@RenderBody()**: Placeholder-ul unde va fi injectat conținutul View-ului specific.


* 
**@await RenderSectionAsync("Scripts", ...)**: Permite injectarea scripturilor specifice dintr-un View în Layout.



### Partial View

Reprezintă secvențe de cod refolosibile în mai multe pagini (ex: afișarea detaliilor unui articol atât în lista `Index`, cât și în pagina `Show`).

**Apelarea unui Partial View:**

```html
<partial name="ArticleInfo" model="article" />

```

Parametrii includ `name` (numele fișierului fără extensie) și `model` (datele transmise către parțial).

## Dezvoltarea Aplicațiilor Web utilizând ASP.NET Core MVC - Laborator 8

Acest laborator se concentrează pe implementarea validărilor și optimizarea structurii vizuale a aplicației utilizând concepte precum **Model Validation**, **ModelState**, **Partial Views** și **Layouts**.

---

### 1. Modificarea Modelelor (Data Annotations)

Se adaugă atribute de validare pentru a impune reguli asupra datelor introduse:

* **Modelul Article**:
* 
**Titlu**: Obligatoriu (`Required`), lungime maximă de 100 de caractere (`StringLength`) și minim 5 caractere (`MinLength`).


* 
**Conținut**: Obligatoriu (`Required`).


* 
**Categorie**: Selectarea unei categorii este obligatorie (`Required`).




* **Modelul Category**:
* 
**Nume**: Obligatoriu (`Required`).




* **Modelul Comment**:
* 
**Conținut**: Obligatoriu (`Required`).





---

### 2. Preluarea Validărilor în View

Mesajele de validare definite în Model nu apar automat în browser; ele trebuie preluate în fișierele `.cshtml`.

* 
**`asp-validation-for`**: Se utilizează pentru a afișa eroarea specifică fiecărui câmp lângă input-ul respectiv.


* 
**`asp-validation-summary`**: Se implementează în View-urile `New` și `Edit` pentru a afișa un sumar al tuturor erorilor de validare apărute.



---

### 3. Validarea la nivel de Controller

În metodele de tip `HttpPost`, este esențială verificarea stării modelului prin variabila `ModelState`.

* 
**Logică**: Dacă `ModelState.IsValid` este `true`, datele sunt salvate în baza de date.


* 
**Gestionarea erorilor**: Dacă validările eșuează (ramura `else`), metoda trebuie să returneze View-ul trimițând înapoi obiectul modelului pentru a păstra datele introduse și a afișa erorile.



---

### 4. Optimizarea Interfeței (Partial View & Layout)

* 
**Partial View (`ArticleInfo`)**: Se creează un fișier separat pentru codul HTML utilizat pentru afișarea unui articol, eliminând redundanța între View-urile `Index` și `Show`.


* **Actualizarea Layout-ului**: Se modifică `_Layout.cshtml` pentru a include link-uri de navigare către:
* Afișarea tuturor articolelor.


* Afișarea tuturor categoriilor.


* Adăugarea unui articol nou.




* 
**Redirecționare Logo**: Logo-ul aplicației va redirecționa acum către `/Articles/Index` în loc de `/Home/Index`.



---

### 5. Cazul special: Adăugarea Comentariilor

Deoarece formularul de adăugare a unui comentariu se află în pagina `Show` a unui articol, se aplică o logică specifică:

* 
**Mutarea Metodei**: Metoda de adăugare (`HttpPost`) este mutată în `ArticlesController` sub numele `Show`.


* 
**Atributul `[FromForm]**`: Utilizat pentru a specifica faptul că datele obiectului `Comment` trebuie preluate exclusiv din formularul HTML.


* 
**Păstrarea Contextului**: Dacă validarea comentariului eșuează, se reîncarcă articolul cu toate comentariile sale pentru a oferi o experiență de utilizare continuă.



---

### Resurse: Atribute pentru sursa datelor

Când datele nu sunt transmise corect automat, se pot folosi atribute pentru a indica sursa lor explicită:

| Atribut | Sursa datelor |
| --- | --- |
| **`[FromBody]`** | Corpul cererii HTTP (ex: JSON) 

 |
| **`[FromForm]`** | Datele unui formular HTML (cerere POST) 

 |
| **`[FromQuery]`** | Parametrii din query string (URL) 

 |
| **`[FromRoute]`** | Parametrii de rută din URL 

 |
| **`[FromHeader]`** | Antetele cererii HTTP (ex: token-uri) 

 |
| **`[FromServices]`** | Injectare directă din containerul de dependențe 

 |
