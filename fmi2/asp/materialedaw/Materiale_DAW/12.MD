# Web Application Development using ASP.NET Core MVC - Course 12

This course covers the integration of AI services for sentiment analysis within an ASP.NET Core MVC application, specifically focusing on OpenAI and Google AI (Gemini).

---

## 1. Creating an OpenAI Account and Obtaining an API Key

To use OpenAI services, follow these steps:

* 
**Step 1: Access the Registration Page:** Navigate to [https://platform.openai.com/signup](https://platform.openai.com/signup).


* 
**Step 2: Complete Registration:** Create an account using an email address or through Google, Apple, or Microsoft.


* 
**Step 3: Access API Keys Section:** After logging in, navigate to the "API keys" section under "Manage" in the left sidebar.


* 
**Step 4: Create a New Key:** Click "+ Create new secret key". You can configure:


* 
**Owned by:** "You" or "Service account".


* 
**Name:** A descriptive name (e.g., "App Web Production").


* 
**Permissions:** Select "All" for full access.




* 
**Step 5: Save the Key:** Copy and save the key immediately. **Warning:** The key is displayed only once and will not be visible after closing the window.



> 
> **Important:** Never share your API key or expose it in client-side code. Use Environment Variables, User Secrets, or Azure Key Vault for production.
> 
> 

---

## 2. Implementing Sentiment Analysis

The application implements an automated sentiment analysis system for comments on the `ArticlesApp` platform.

Main Features 

* 
**Automatic Analysis:** Analyzes sentiment when a comment is posted.


* 
**Classification:** Categorizes comments as "positive", "neutral", or "negative".


* 
**Confidence Score:** Provides a score between 0% and 100%.


* 
**Admin Visibility:** Sentiment labels are only visible to users with the **Admin** role.



Data Flow 

1. User posts a comment.


2. 
`ArticlesController` receives the request.


3. 
`SentimentAnalysisService` sends the text to the AI API.


4. API returns `{label, confidence}`.


5. Comment is saved in the Database with sentiment data.


6. View displays the sentiment label for Admins.



---

## 3. Technical Implementation Steps

### Step 1: Modify the Comment Model

Add fields to store sentiment results in `Models/Comment.cs`:

```csharp
public string? SentimentLabel { get; set; [cite_start]} // positive, neutral, negative [cite: 175, 177]
public double? SentimentConfidence { get; set; [cite_start]} // 0.0 - 1.0 [cite: 180, 188]
public DateTime? SentimentAnalyzedAt { get; set; [cite_start]} // Audit timestamp [cite: 181, 189]

```

### Step 2: Create the Sentiment Analysis Service

The service uses `ISentimentAnalysisService` for Dependency Injection, allowing easy implementation swaps (e.g., switching from OpenAI to Google AI).

**Key Prompting Rules:**
The service uses a "system prompt" to force the AI to respond **only** with a fixed JSON format to ensure successful automated parsing.

### Step 3: Configure the API Key

Store the key in `appsettings.json`:

```json
"OpenAI": {
  "ApiKey": "sk-proj-____"
}

```

### Step 4: Register Service in DI Container

In `Program.cs`, register the service as Scoped (new instance per HTTP request).

### Step 5: Update Database

Create and apply migrations using the terminal:

* 
**Windows:** `Add-Migration AddSentimentToComments` then `Update-Database`.


* 
**Mac/Linux:** `dotnet ef migrations add AddSentimentToComments` then `dotnet ef database update`.



---

## 4. Switching to Google AI (Gemini)

The architecture allows switching providers by implementing the same `ISentimentAnalysisService` interface.

1. 
**Obtain Key:** Get a key from [Google AI Studio](https://aistudio.google.com/).


2. 
**Add Configuration:** Add `"GoogleAI": { "ApiKey": "..." }` to `appsettings.json`.


3. 
**Update Registration:** Change the implementation in `Program.cs`:


```csharp
[cite_start]builder.Services.AddScoped<ISentimentAnalysisService, GoogleSentimentAnalysisService>(); [cite: 1056, 1057]

```


