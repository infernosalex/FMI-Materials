# Dezvoltarea Aplicațiilor Web utilizând ASP.NET Core MVC - Curs 11

## Cuprins

* REST API și Implementarea unei Aplicații CRUD cu ASP.NET Core și Identity 


* Crearea Proiectului în Visual Studio 


* Introducere în REST API 


* Sistemul de fișiere 


* Sistemul de Rutare 


* Configurarea Identity Framework 


* Implementarea CRUD pentru ArticlesController 


* Gestionarea Utilizatorilor 



---

## Crearea Proiectului în Visual Studio

Pentru a crea o aplicație REST API cu ASP.NET Core și Identity:

1. 
**Deschideți Visual Studio** și selectați **Create a new project**.


2. Alegeți **ASP.NET Core Web API**.


3. Introduceți un nume pentru proiect (ex: `Laborator11RESTAPI`).


4. Selectați **.NET 9** ca framework.


5. **Opțiuni de activat:**
* 
**Enable OpenAPI support:** Pentru documentarea API-ului cu **Swagger**. Swagger oferă o interfață interactivă pentru a testa API-ul fără unelte externe precum Postman.


* 
**Configure for HTTPS**.


* 
**Use controllers:** Această opțiune configurează proiectul să folosească Controllers pentru gestionarea logicii API-ului.





---

## Introducere în REST API

**REST (Representational State Transfer)** este un stil arhitectural pentru comunicarea client-server prin HTTP. Spre deosebire de MVC-ul tradițional care returnează View-uri HTML, un REST API returnează date în format **JSON** sau **XML**.

### Avantaje:

* Separare completă între client și server.


* Poate fi consumat de diverse platforme: web, mobile, IoT.


* Scalabilitate și reutilizare.



### Concepte Cheie:

* 
**Endpoint:** Un punct final de comunicare (URL specific) unde clienții trimit cereri.


* **Metode HTTP (Verbe):**
* 
**GET:** Afișează informații.


* 
**POST:** Creează o resursă.


* 
**PUT:** Actualizează o resursă.


* 
**DELETE:** Șterge o resursă.





---

## Sistemul de Rutare și Structura Fișierelor

### Structura Recomandată:

* 
**/Controllers:** Metodele pentru endpoint-uri.


* 
**/Models:** Definirea entităților (ex: `Article.cs`, `Product.cs`).


* 
**/Data:** Contextul bazei de date (`AppDbContext`).


* 
**/Services:** Logica de business (ex: `ProductService.cs`).



### Exemplu de Rutare:

Utilizarea adnotărilor `[Route("api/[controller]")]` și `[ApiController]` permite configurarea automată a rutelor. De exemplu, un controller numit `ArticlesController` va avea ruta de bază `api/articles`.

---

## Configurarea Identity Framework

Pentru a gestiona utilizatorii în .NET 9 (versiunea 9.0.9), sunt necesare următoarele pachete:

* `Microsoft.AspNetCore.Identity.EntityFrameworkCore`
* `Microsoft.EntityFrameworkCore.SqlServer`
* `Microsoft.EntityFrameworkCore.Tools`

### Configurarea în Program.cs:

```csharp
builder.Services.AddDbContext<AppDbContext>(options =>
    options.UseSqlServer(builder.Configuration.GetConnectionString("DefaultConnection")));

builder.Services.AddIdentity<IdentityUser, IdentityRole>()
    .AddEntityFrameworkStores<AppDbContext>()
    .AddDefaultTokenProviders();

```



---

## Gestionarea Utilizatorilor cu JWT

Într-un API RESTful, autentificarea se face de obicei prin **JSON Web Tokens (JWT)**.

### Fluxul de lucru JWT:

1. 
**Login:** Clientul trimite email-ul și parola.


2. 
**Generare:** Serverul validează datele și returnează un JWT.


3. 
**Stocare:** Clientul salvează token-ul și îl trimite în antetul `Authorization: Bearer <token>` la fiecare cerere ulterioară.


4. 
**Validare:** Serverul verifică semnătura și valabilitatea token-ului înainte de a procesa cererea.



> **Notă Importantă:** Cheile secrete pentru semnarea JWT nu trebuie păstrate direct în codul sursă. Se recomandă utilizarea unor sisteme precum **Azure Key Vault** sau **dotnet Secret Manager**.
> 
> 

---

## Implementarea ArticlesController

Pentru a preveni ciclurile de serializare (recursivitate infinită) cauzate de relațiile bidirecționale din Entity Framework, se utilizează adnotarea `[JsonIgnore]` pe proprietățile virtuale ale colecțiilor.

### Exemplu Metodă Index (GET):

```csharp
[HttpGet]
public async Task<ActionResult<IEnumerable<Article>>> Index()
{
    var articles = await db.Articles
        .Include(a => a.Category)
        .Include(a => a.User)
        .ToListAsync();

    if (articles == null || articles.Count == 0)
        return NotFound();

    return Ok(articles);
}

```



### Accesarea Swagger

Pentru a testa API-ul, Swagger este accesibil la adresa: `https://localhost:7020/swagger/`. Asigurați-vă că `launchBrowser` este setat pe `True` în `launchSettings.json`.
