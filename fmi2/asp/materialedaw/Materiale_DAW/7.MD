# Dezvoltarea Aplicațiilor Web utilizând ASP.NET Core MVC - Curs 7

## Cuprins

* 
**View (interfața cu utilizatorul)** 


* 
**Ce este View-ul** 


* 
**Razor în cadrul unui proiect ASP.NET Core MVC** 


* 
**Crearea unui View în cadrul unui proiect** 


* 
**Trimiterea datelor către View** 


* 
**Model** 


* 
**ViewBag** 


* 
**ViewData** 


* 
**TempData** 




* 
**Helpere pentru View** 


* 
**Exemple pentru implementarea alternativă a Helperelor** 



---

## View (interfața cu utilizatorul)

View-ul reprezintă componenta arhitecturii **MVC** cu care utilizatorii interacționează direct prin intermediul browser-ului.

### Caracteristici principale:

* 
**Afișarea datelor**: În View se afișează înregistrările din baza de date și informațiile generate de aplicație.


* 
**Tipuri de conținut**: Poate conține **HTML static** sau **HTML dinamic** (trimis din Controller).


* 
**Comunicare**: În cadrul arhitecturii MVC, View-ul comunică direct **doar cu Controller-ul**. Comunicarea cu Modelul se realizează indirect, tot prin intermediul Controller-ului.



### Structura folderelor

* View-urile se află în folderul principal **Views**.


* Fiecare Controller are un folder separat în interiorul `Views`, purtând același nume ca și Controller-ul respectiv.


* Folderul **Shared** conține elemente comune, precum layout-uri sau view-uri parțiale, folosite în mai multe pagini ale aplicației.



---

## Razor în ASP.NET Core MVC

**Razor** este motorul de afișare utilizat încă din ASP.NET MVC 3. Acesta permite mixarea tag-urilor HTML cu cod C#.

### Sintaxa Razor:

* 
**Simbolul `@**`: Se folosește pentru a începe o secvență de cod server-side.


* 
**Cod pe o singură linie**: Se utilizează `@` urmat de variabilă (ex: `<h3>@ViewBag.Article.Title</h3>`).


* 
**Blocuri de cod**: Pentru mai multe linii de instrucțiuni se folosesc acoladele: `@{ /* cod */ }`.


* 
**Text în cod**: În cadrul unui bloc de cod, se poate afișa text folosind `@:` (ex: `@:este adevărat`).


* **Structuri de control**:
* 
**If**: `@if(conditie) { ... }`.


* 
**For**: `@for (int i=0; i<10; i++) { ... }`.


* 
**Foreach**: `@foreach (var item in colectie) { ... }`.





---

## Trimiterea datelor către View

Există mai multe modalități de a transfera date de la Controller către View:

| Metodă | Descriere |
| --- | --- |
| **Model** | Folosit pentru trimiterea obiectelor din baza de date prin helper-ul `@model`.

 |
| **ViewBag** | Obiect dinamic ce permite transferul datelor care nu se regăsesc în Model.

 |
| **ViewData** | Similar cu ViewBag, dar sub formă de **Dicționar** (cheie-valoare), unde cheia este un string.

 |
| **TempData** | Stochează valori disponibile pentru un **request subsecvent** (ex: după un redirect). Datele sunt șterse după prima accesare.

 |

> 
> **Observație**: ViewBag inserează datele în dicționarul ViewData. Dacă se folosește același nume pentru o proprietate în ambele, ultima valoare alocată va suprascrie valorile anterioare.
> 
> 

---

## Helpere pentru View

ASP.NET Core MVC oferă Helpere pentru a genera automat elemente HTML și pentru a facilita procesul de **model binding**.

### Categorii de Helpere:

1. 
**Tag Helpers**: Arhitectură modernă, procesate la compilare, oferă suport mai bun pentru IDE (autocomplete).


2. 
**HTML Helpers**: Procesate la runtime, pot genera o ușoară scădere de performanță în aplicații foarte mari.



### Exemple de corespondență:

* 
**Link**: `Html.ActionLink` vs `<a asp-action="..." asp-controller="...">`.


* 
**Input text**: `Html.TextBox` vs `<input asp-for="Property" />`.


* 
**Parolă**: `Html.Password` vs `<input type="password" asp-for="Property" />`.


* 
**Editor**: `Html.Editor` - generează automat tipul de input în funcție de tipul proprietății din Model (numeric pentru `int`, textbox pentru `string` etc.).



---

### Crearea unui View (Pași)

1. 
**PASUL 1**: Click dreapta pe folderul asociat din `Views` -> **Add**.


2. 
**PASUL 2**: Selectare **Razor View - Empty** sau **Razor View**.


3. 
**PASUL 3**: Introducerea numelui fișierului cu extensia `.cshtml` și apăsarea butonului **Add**.


# Dezvoltarea Aplicațiilor Web utilizând ASP.NET Core MVC - Laborator 7

## Obiective și Configurare Inițială

Laboratorul se concentrează pe utilizarea **Tag Helpers** și gestionarea datelor între Controller și View folosind modele și variabile de tip **TempData**.

* 
**Modele utilizate**: `Article.cs`, `Category.cs` și `Comment.cs`.


* **Configurare**:
* Modificarea stringului de conexiune în `appsettings.json`.


* Executarea migrației: `AddUserArticleCategoryCommentModels`.


* Aplicarea modificărilor în baza de date: `Update-Database`.





---

## Implementare ArticlesController și View-uri

### 1. Afișarea unui articol (Metoda Show)

* 
**Controller**: Se modifică metoda `Show` pentru a realiza o operație de **join** și se trimite obiectul de tip `Article` direct ca Model către View.


* 
**View**: Trebuie să includă direct modelul (`@model ArticlesApp.Models.Article`) pentru a afișa proprietățile acestuia.


* **Tag Helpers pentru Link-uri**:
* 
*Link inițial*: `<a href="/Articles/Edit/@Model.Id">`.


* 
*Link cu Tag Helpers*: `<a asp-controller="Articles" asp-action="Edit" asp-route-id="@Model.Id">`.





### 2. Adăugarea unui articol (Metoda New)

* 
**Dropdown Categorii**: Se utilizează o metodă `GetAllCategories()` care returnează o listă de tip `IEnumerable<SelectListItem>` pentru a popula elementul de tip dropdown.


* 
**Proprietate specială**: În modelul `Article`, se adaugă proprietatea `Categ` marcată cu atributul `[NotMapped]` pentru a stoca lista de categorii fără a o salva în baza de date.


* **Sintaxă Dropdown**:
```html
<select asp-for="CategoryId" asp-items="Model.Categ" class="form-control">
    <option value="">Selectati categoria</option>
</select>
[cite_start]``` [cite: 820, 821]

```


* 
**Mesaje Feedback**: Se utilizează `TempData` pentru a afișa mesaje precum "Articolul a fost adăugat" după acțiunea de tip POST.



### 3. Editarea și Ștergerea

* 
**Edit (GET)**: Preia categoriile și trimite modelul `Article` către View-ul de editare.


* 
**Edit (POST)**: Salvează modificările și notifică utilizatorul via `TempData["message"] = "Articolul a fost modificat"`.


* 
**Delete**: După ștergere, se afișează mesajul "Articolul a fost șters".



---

## Noțiuni Teoretice: DbSet și Entity Framework Core

### Ce este DbSet?

`DbSet<T>` este o proprietate din `ApplicationDbContext` care reprezintă o colecție de entități ce permite operații de interogare (query) și modificare.

* 
**IQueryable**: `DbSet<T>` implementează `IQueryable<T>`, permițând utilizarea **LINQ** pentru a scrie interogări în C# care sunt traduse ulterior în SQL.


* **Execution (Materializare)**: Interogările LINQ nu se execută imediat (deferred execution). Acestea se execută doar la materializare, de exemplu prin apelarea metodelor `.ToList()`, `.First()`, sau prin iterare într-un `foreach`.



### Procesul la Runtime

1. 
**Construire Query**: Metodele `.Include()` sau `.Where()` construiesc un "expression tree".


2. 
**Traducere**: EF Core traduce acest arbore în instrucțiuni SQL (ex: `SELECT`, `LEFT JOIN`).


3. 
**Change Tracker**: `DbContext` monitorizează starea entităților (`Unchanged`, `Added`, `Modified`, `Deleted`) până la apelarea `SaveChanges()`, moment în care se execută efectiv comenzile în baza de date.
