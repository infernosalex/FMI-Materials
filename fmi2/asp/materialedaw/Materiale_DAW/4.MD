Acest document reprezintă suportul de curs pentru **Dezvoltarea Aplicațiilor Web utilizând ASP.NET Core MVC (Curs 4)**, susținut de Cezara Benegui. Cursul se concentrează pe rolul, structura și funcționalitățile **Controller-ului** în arhitectura MVC.

---

## 1. Ce este Controller-ul?

În arhitectura MVC, **Controller-ul** este componenta responsabilă pentru procesarea URL-urilor aplicației.

* Este o clasă care derivă din clasa de bază `Microsoft.AspNetCore.Mvc`.


* Conține metode publice numite **Acțiuni (Actions)**.


* **Roluri principale**:
* Procesează request-urile venite de la browser.


* Apelează modelele și procesează datele.


* Trimite răspunsul final către utilizator prin browser.




* 
**Convenții de denumire**: Numele trebuie să se termine obligatoriu cu sufixul `Controller` (ex: `HomeController`).


* 
**Locație**: Controller-ele se adaugă în folderul `Controllers` al proiectului.



---

## 2. Crearea și Adăugarea unui Controller

Pentru a începe un proiect nou, se utilizează șablonul **ASP.NET Core Web App (Model-View-Controller)**.

### Pașii pentru adăugarea unui Controller nou:

1. 
**Click dreapta** pe folderul `Controllers` -> **Add** -> **Controller**.


2. Din fereastra de dialog, se selectează **MVC Controller - Empty**.


3. Se alege **ASP.NET Core** din meniul stâng, apoi din nou **MVC Controller - Empty**.


4. Se introduce numele (ex: `StudentsController.cs`), asigurându-vă că păstrați sufixul `Controller`.



---

## 3. Acțiuni (Actions)

Acțiunile sunt metodele publice dintr-un Controller care răspund cererilor HTTP.

### Structura unei metode

```csharp
public class StudentsController : Controller
{
    public IActionResult Index()
    {
        return View();
    }
}

```

* 
**Publicitate**: Metodele trebuie să fie `public` pentru a fi accesate de framework. Metodele `private` sunt folosite doar intern.


* 
**Supraîncărcare**: Acțiunile pot fi supraîncărcate doar dacă au parametri diferiți (număr sau tip); semnătura trebuie să fie distinctă.



### Tipul de returnare: `IActionResult`

* Este o interfață abstractă ce permite diferite tipuri de răspunsuri HTTP.


* 
**Clasa `ActionResult**`: Implementează `IActionResult` și este clasa de bază pentru toate rezultatele acțiunilor.



| Tip Rezultat | Metodă Controller | Descriere |
| --- | --- | --- |
| **ViewResult** | `View()` | Returnează conținut HTML (fișier `.cshtml`).

 |
| **EmptyResult** | - | Returnează un răspuns gol (Status 200).

 |
| **ContentResult** | `Content()` | Returnează text simplu.

 |
| **JsonResult** | `Json()` | Returnează date serializate în format JSON.

 |
| **RedirectResult** | `Redirect()` | Redirecționare către un URL (string).

 |
| **FileResult** | `File()` | Manipulare și descărcare de fișiere.

 |
| **StatusCodeResult** | `StatusCode()` | Returnează coduri de status (400, 401, 404 etc.).

 |

---

## 4. Selectori și Verbe HTTP

Selectorii sunt atribute care ajută sistemul de rutare să aleagă acțiunea corectă.

* 
**ActionName**: Permite definirea unui nume de rută diferit de numele metodei (ex: `[ActionName("afisare")]`).


* 
**NonAction**: Indică faptul că o metodă publică nu este o acțiune și nu poate fi accesată prin URL.


* **Action Verbs**: Specifică verbul HTTP la care răspunde metoda. Verbul implicit este **GET**.


* 
**GET**: Accesare resursă/pagină.


* 
**POST**: Creare resursă sau trimitere date prin formular.


* 
**PUT/PATCH/DELETE**: În ASP.NET Core MVC, pentru editare și ștergere se folosește adesea tot `[HttpPost]`.





---

## 5. Redirecționarea (Redirect)

Există mai multe metode pentru a trimite utilizatorul către o altă pagină:

1. 
**Redirect**: Redirecționare către un URL specific (HTTP 302).


2. 
**RedirectToRoute**: Redirecționare folosind numele rutei definit în `Program.cs`.


3. 
**RedirectToAction**: Redirecționare către o altă metodă (din același Controller sau unul diferit).


4. **Redirect Permanent (HTTP 301)**: `RedirectPermanent`, `RedirectToRoutePermanent`. Răspunsul este stocat în cache-ul browserului. Se folosește pentru schimbări definitive de URL sau optimizare SEO.



---

Acest document cuprinde exercițiile practice pentru **Laboratorul 4** al cursului **Dezvoltarea Aplicațiilor Web utilizând ASP.NET Core MVC**. Accentul este pus pe implementarea operațiilor CRUD într-un Controller, utilizarea modelelor și a selectorilor.

---

## Exercițiul 1: Crearea proiectului și a modelului Article

Se va crea un proiect numit **Laborator4** și se va adăuga un Controller numit `ArticlesController`.

### 1. Definirea Modelului

În folderul `Models`, se adaugă clasa `Article.cs` cu următoarea structură:

```csharp
public class Article
{
    public int Id { get; set; [cite_start]} [cite: 582]
    public string Title { get; set; [cite_start]} [cite: 582]
    public string Content { get; set; [cite_start]} [cite: 582]
    public DateTime Date { get; set; [cite_start]} [cite: 583]
}

```

### 2. Metoda NonAction `GetArticles()`

Deoarece nu se utilizează o bază de date în acest laborator, se va crea o metodă marcată cu atributul `[NonAction]` pentru a genera date de test.

* 
**Rol**: Returnează un array de obiecte `Article`.


* 
**Implementare**: Se instanțiază un array de 3 articole, populând câmpurile `Id`, `Title`, `Content` și `Date` într-un ciclu repetitiv.



---

## Operații C.R.U.D. și Vizualizare

### 3. Metoda Index

* 
**Controller**: Apelează `GetArticles()` și transmite datele către View folosind `ViewBag.Articles`.


* 
**View (`Index.cshtml`)**: Trebuie să afișeze lista tuturor articolelor și să ofere link-uri pentru vizualizarea și editarea fiecăruia.



### 4. Metoda Show (Vizualizare)

* 
**Funcționalitate**: Afișează detaliile unui singur articol bazat pe `id`.


* 
**Gestionarea erorilor**: Dacă articolul nu este găsit, se returnează un View numit `Error` care afișează mesajul "Articolul căutat nu poate fi găsit" și detalii despre excepție.


* 
**Rutare**: Se va configura o rută personalizată `ArticlesShow` pentru a accesa metoda prin `/articole/show/{id}` în loc de `/Articles/Show/{id}`.



---

## Metodele pentru Adăugare, Editare și Ștergere

### 5. New (Adăugare)

Se folosesc două metode în Controller:

* 
**`[HttpGet] New()`**: Afișează formularul de creare.


* **`[HttpPost] New(Article article)`**: Primește datele de la server. Momentan, returnează un View (`NewPostMethod`) care confirmă succesul operațiunii printr-un mesaj.



### 6. Edit (Editare)

* 
**`[HttpGet] Edit(int? id)`**: Încarcă datele articolului existent într-un formular.


* **`[HttpPost] Edit(Article article)`**: Trimite modificările către server. Poate redirecționa către `Index` sau afișa un mesaj de succes.



### 7. Delete (Ștergere)

* Se implementează în `ArticlesController` folosind verbul **`[HttpPost]`**.


* Butonul de ștergere este inserat într-un formular în pagina `Show`.


* După procesare, se returnează un mesaj de confirmare: "Articolul a fost sters din baza de date!".



---

## Exerciții avansate și Selectori

* 
**Redenumire**: Redenumiți metoda `Index` în `listare` folosind selectori (`ActionName`).


* 
**Configurare rută**: Modificați ruta implicită în `Program.cs` astfel încât aplicația să pornească direct cu pagina de listare a articolelor.



---

**Ar trebui să vă ajut cu scrierea codului complet pentru `ArticlesController` sau a paginii de eroare `Error.cshtml` conform acestor cerințe?**