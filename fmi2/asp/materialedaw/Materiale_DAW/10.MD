## Dezvoltarea Aplicațiilor Web utilizând ASP.NET Core MVC - Curs 10

### Cuprins

* 
**Implementarea relației many-to-many** (Pagina 2) 


* 
**Implementarea claselor** (Pagina 5) 


* 
**Afişarea paginată** (Pagina 9) 


* 
**Includerea unui editor de text** (Pagina 12) 


* 
**Funcționalitatea de căutare** (Pagina 23) 


* 
**Design-ul într-o aplicație Web** (Pagina 27) 


* 
**User Experience (UX)** (Pagina 29) 


* 
**Alegerea culorilor potrivite** (Pagina 32) 



---

### 1. Implementarea relației many-to-many

Pentru exemplificarea relației **many-to-many**, se extinde diagrama proiectată anterior prin adăugarea tabelului **Bookmark**.

#### Specificații ale relației:

* Relația se stabilește între **Article** și **Bookmark**.


* Utilizatorii (rolurile User, Editor, Admin) își pot crea propriile colecții (Bookmarks).


* Utilizatorii cu rolurile User/Editor au acces doar la propriile colecții, în timp ce Admin-ul are acces la toate.


* Un articol poate face parte din mai multe colecții, iar o colecție poate conține mai multe articole.



#### Structura Claselor:

* 
**Bookmark**: Conține `Id` (PK), `Name` (Required), și `UserId` (FK către creator).


* 
**ArticleBookmark (Tabel asociativ)**: Conține o cheie primară compusă din `Id`, `ArticleId` și `BookmarkId`. Include și `BookmarkDate` pentru a înregistra momentul adăugării.



---

### 2. Implementarea claselor și a Contextului

#### Configurare Model (Fluent API)

În `ApplicationDbContext.cs`, se definește cheia primară compusă și relațiile pentru tabelul asociativ:

```csharp
modelBuilder.Entity<ArticleBookmark>()
    .HasKey(ab => new { ab.Id, ab.ArticleId, ab.BookmarkId });

modelBuilder.Entity<ArticleBookmark>()
    .HasOne(ab => ab.Article)
    .WithMany(ab => ab.ArticleBookmarks)
    .HasForeignKey(ab => ab.ArticleId);

```

> 
> **Observație**: După modificarea claselor, este obligatorie executarea comenzilor `Add-Migration` și `Update-Database`.
> 
> 

---

### 3. Afişarea paginată

Paginarea este esențială pentru gestionarea unui volum mare de date. În exemplul oferit, se afișează **3 articole pe pagină**.

* 
**Logica în Controller**: Se calculează `offset`-ul pe baza paginii curente (`(currentPage - 1) * _perPage`) și se utilizează metodele `.Skip(offset).Take(_perPage)` pentru a prelua subsetul corect de date.


* 
**Interfață**: Se utilizează componenta **Pagination** din Bootstrap.



---

### 4. Integrarea unui Editor de Text (Summernote)

**Summernote** este un editor de tip **WYSIWYG** (What You See Is What You Get) bazat pe jQuery și Bootstrap.

#### Pași de integrare:

1. Includerea fișierelor CSS și JS în `_Layout.cshtml` (via CDN).


2. Inițializarea editorului într-un fișier JavaScript separat prin selectarea clasei `.summernote`.


3. Utilizarea atributului `class="summernote"` pe elemente `<textarea>`.



#### Securitate și Prevenire XSS:

* Pentru afișarea conținutului HTML din baza de date se folosește `@Html.Raw()`, dar acest lucru expune aplicația la atacuri **Cross-Site Scripting (XSS)**.


* 
**Soluție**: Instalarea pachetului **HtmlSanitizer** din NuGet pentru a filtra tag-urile periculoase înainte de salvarea datelor în baza de date.



---

### 5. Funcționalitatea de căutare

Căutarea este implementată pentru a filtra articolele după **titlu**, **conținut** și **conținutul comentariilor**.

* 
**Implementare**: Se preia șirul de căutare prin parametrul `search` din URL (`GET`).


* 
**Integrare cu Paginarea**: URL-ul rezultat trebuie să păstreze ambii parametri: `/Articles/Index/?search=valoare&page=numar`.



---

### 6. Design și User Experience (UX)

#### Reguli de bază în Design:

* 
**Simplitatea**: Evitarea supraîncărcării paginii cu informații.


* 
**Consistența**: Menținerea aceluiași stil vizual în toată aplicația.


* 
**Responsiveness**: Utilizarea *media queries* pentru adaptarea la orice rezoluție.


* 
**Fonturi**: Se recomandă fonturi **Sans Serif** (Arial, Verdana) la dimensiunea de **16px** pentru lizibilitate.



#### Principii UX:

* 
**Tu nu ești utilizatorul final**: Testarea cu utilizatori reali (*usability testing*) este esențială.


* 
**Feedback**: Informarea constantă a utilizatorului (mesaje de succes, loading bars, erori de validare).


* 
**Spații albe**: Ajută la scanarea rapidă a informației de către utilizator.



#### Alegerea Culorilor:

* 
**Tehnica 60-30-10**: 60% culoare dominantă, 30% secundară, 10% accente.


* 
**Simbolistică**: **Roșu** (erori/încredere), **Verde** (succes/calm), **Alb** (puritate/simplitate).



---
## Dezvoltarea Aplicațiilor Web utilizând ASP.NET Core MVC - Laborator 10

### Exerciții și Cerințe Implementare

#### 1. Gestiunea Colecțiilor (Bookmarks)

Pornind de la diagrama conceptuală, se va implementa funcționalitatea de adăugare a articolelor în colecții cu următoarele reguli:

* 
**Creare și Acces**: Utilizatorii pot crea colecții proprii. Aceștia au acces exclusiv la colecțiile create de ei (vizualizare, editare, ștergere).


* 
**Roluri**: Utilizatorii cu rolurile **User**, **Editor** și **Admin** pot crea colecții. Admin-ul are acces la toate colecțiile din platformă, în timp ce restul utilizatorilor au acces doar la cele proprii.


* 
**Funcționalitate**: Utilizatorii selectează articole existente în platformă și le adaugă în colecții.


* 
**Relație**: Un articol poate face parte din mai multe colecții, iar o colecție poate conține mai multe articole (relație many-to-many).



#### 2. Administrare Utilizatori

* Administratorii au dreptul de a activa sau revoca drepturile celorlalți utilizatori.


* Aceștia pot, de asemenea, să editeze și să șteargă utilizatori din aplicație.



#### 3. Integrare Funcționalități Curs 10

* 
**Paginare**: Implementarea afișării paginate a articolelor.


* 
**Editor Text**: Integrarea editorului **Summernote**.


* 
**Căutare**: Implementarea motorului de căutare pentru articole după titlu, conținut sau conținutul comentariilor.



---

### Design și Stilizare

#### 4. Fonturi și Tipografie

Pentru integrarea fonturilor (ex: Roboto, Montserrat):

1. Se utilizează `@import` din Google Fonts direct în `wwwroot/css/site.css`.


2. Utilizarea claselor CSS personalizate pentru aplicarea `font-family`.



#### 5. Logo și Footer

* 
**Logo**: Se stilizează folosind fontul *Permanent Marker* în `_Layout.cshtml` și `site.css`.


* **Footer**:
* Trebuie să fie fixat în partea de jos a paginii (`position: fixed`).


* Afișează logo-ul și anul curent utilizând `@DateTime.Now.Year`.





#### 6. Culori

* Se recomandă utilizarea [Flat UI Colors](https://flatuicolors.com/) pentru alegerea paletei cromatice.



---

### Pagina Principală (Home/Index)

#### 7. Logica de Afișare pentru Utilizatori Neautentificați

Dacă un utilizator nu este autentificat, pagina principală afișează doar 3 articole:

* 
**Primul articol**: Afișat pe un rând și o coloană. Se preia folosind `.First()`.


* 
**Următoarele două articole**: Afișate pe același rând, dar pe două coloane. Se preiau folosind `.Skip(1).Take(2)`.


* 
**Restricții Conținut**: Nu se afișează tot conținutul; se utilizează `line-clamp` pentru a limita rândurile afișate.



---

### Meniu și Accesibilitate (Layout.cshtml)

Link-urile din meniu sunt condiționate de rolul utilizatorului:

| Rol | Link-uri accesibile |
| --- | --- |
| **Neautentificat** | Doar logo-ul aplicației (redirecționează către Home/Index) 

 |
| **User** | Afișare articole, Colecții 

 |
| **Editor** | Afișare articole, Adăugare articol, Colecții 

 |
| **Admin** | Toate cele de mai sus + Afișare categorii, Afișare utilizatori 

 |

---

### Exemplu Implementare: HomeController

```csharp
public IActionResult Index()
{
    // Dacă utilizatorul este autentificat, merge la lista completă de articole
    if (User.Identity.IsAuthenticated)
    {
        [cite_start]return RedirectToAction("Index", "Articles"); [cite: 1008, 1010]
    }

    [cite_start]var articles = from article in db.Articles select article; [cite: 1012]
    
    // Preluare articole pentru pagina de start (vizitatori)
    [cite_start]ViewBag.FirstArticle = articles.First(); [cite: 1014]
    [cite_start]ViewBag.Articles = articles.OrderBy(o => o.Date).Skip(1).Take(2); [cite: 1015, 1016]

    [cite_start]return View(); [cite: 1017]
}

```
